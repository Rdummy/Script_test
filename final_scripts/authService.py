from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time
import random 

import pickle

def authenticate_user(browser, url, user_matrix, authenticated):
    def sign_in_successful():
        username_field = browser.find_element(By.NAME, 'session_key')
        password_field = browser.find_element(By.NAME, 'session_password')
        submit_button = browser.find_element(By.XPATH, "//button[@data-id='sign-in-form__submit-btn' and @type='submit']")
        time.sleep(10)
        # Carlos User
        # username_field.send_keys(user_matrix[0][0])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
        # password_field.send_keys(user_matrix[0][1])

        username_field.send_keys(user_matrix[1][0])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
        password_field.send_keys(user_matrix[1][1])
        submit_button.click() 

def session_manager(browser):
    pickle.dump(browser.get_cookies())

    while not authenticated:
        sign_in_successful()
        if(EC.url_changes(url)):
            authenticated = True
            print("Authentication Success!")
